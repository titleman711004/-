<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£è€ƒå¤é™¶ç‰‡è¾¨è­˜ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
               text-align: center; background: #1a1a1a; color: #e0e0e0; margin: 0; padding: 20px; }
        h1 { font-size: 1.5rem; color: #ffcc00; }
        #webcam-container { margin-top: 15px; border-radius: 15px; overflow: hidden; 
                           border: 4px solid #444; display: inline-block; line-height: 0; }
        #result-card { background: #333; border-radius: 15px; padding: 20px; 
                      margin: 20px auto; max-width: 400px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        #label-container { font-size: 1.4rem; font-weight: bold; color: #fff; margin-bottom: 10px; }
        #detail-container { font-size: 1rem; color: #bbb; line-height: 1.5; }
        button { background: #ffcc00; color: #000; border: none; padding: 12px 25px; 
                 font-size: 1.1rem; font-weight: bold; border-radius: 50px; cursor: pointer; }
        button:active { background: #e6b800; }
        .loading { color: #888; font-style: italic; }
    </style>
</head>
<body>

    <h1>å°ç£è€ƒå¤æ–‡åŒ– AI è¾¨è­˜</h1>
    <p>è«‹å°æº–é™¶ç‰‡ç´‹é£¾ï¼Œå»ºè­°ä½¿ç”¨å´å…‰ç…§å°„</p>
    
    <button type="button" id="start-btn" onclick="init()">é–‹å•Ÿè¾¨è­˜é¡é ­</button>

    <div id="webcam-container"></div>

    <div id="result-card">
        <div id="label-container">ç­‰å¾…å•Ÿå‹•...</div>
        <div id="detail-container">è«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•ä¸¦å…è¨±ç›¸æ©Ÿæ¬Šé™</div>
    </div>

    <script type="text/javascript">
        // ï¼ï¼ï¼è«‹å°‡æ­¤è™•æ›æˆä½ åœ¨ Teachable Machine è¨“ç·´å¾Œç”Ÿæˆçš„é€£çµ ï¼ï¼ï¼
        const URL = "https://teachablemachine.withgoogle.com/models/p_C0hO9Gf/"; 

        let model, webcam, labelContainer, detailContainer, maxPredictions;

        async function init() {
            document.getElementById("start-btn").style.display = "none";
            labelContainer = document.getElementById("label-container");
            detailContainer = document.getElementById("detail-container");
            labelContainer.innerHTML = "<span class='loading'>è¼‰å…¥ AI æ¨¡å‹ä¸­...</span>";

            try {
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";

                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                // æ‰‹æ©Ÿç«¯é—œéµè¨­å®šï¼šfacingMode: "environment" (å¾Œé¡é ­)
                const flip = false; 
                webcam = new tmImage.Webcam(350, 350, flip); 
                await webcam.setup({ facingMode: "environment" }); 
                await webcam.play();
                
                window.requestAnimationFrame(loop);
                document.getElementById("webcam-container").appendChild(webcam.canvas);
            } catch (e) {
                console.error(e);
                labelContainer.innerHTML = "å•Ÿå‹•å¤±æ•—";
                detailContainer.innerHTML = "è«‹ç¢ºä¿ä½¿ç”¨ HTTPS é€£ç·šä¸¦åœ¨ Safari/Chrome å…è¨±ç›¸æ©Ÿæ¬Šé™ã€‚";
            }
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            
            // æ’åºå–å¾—æ©Ÿç‡æœ€é«˜è€…
            prediction.sort((a, b) => b.probability - a.probability);
            const top = prediction[0];

            if (top.probability > 0.65) {
                const name = top.className;
                labelContainer.innerHTML = `ç™¼ç¾ï¼š${name}`;
                
                // æ ¹æ“šé¡åˆ¥è‡ªå‹•é¡¯ç¤ºæè¿°é‚è¼¯
                let info = "";
                if(name.includes("å¤§åŒå‘")) {
                    info = "ğŸ’¡ é—œéµç‰¹å¾µï¼šç²—ç¹©ç´‹ã€è³ªåœ°ç²—ç³™ã€‚å¯èƒ½æ˜¯å°ç£æœ€æ—©çš„æ–°çŸ³å™¨æ–‡åŒ–ã€‚";
                } else if(name.includes("åä¸‰è¡Œ")) {
                    info = "ğŸ’¡ é—œéµç‰¹å¾µï¼šå¹¾ä½•æ‹å°ç´‹ï¼ˆæ–¹æ ¼ç´‹ï¼‰ã€ç´…è¤é™¶ã€‚å±¬æ–¼é‡‘å±¬å™¨æ™‚ä»£ã€‚";
                } else if(name.includes("åœ“å±±")) {
                    info = "ğŸ’¡ é—œéµç‰¹å¾µï¼šç´ é¢ç„¡ç´‹ã€å …ç¡¬ã€å¸¶æœ‰æŠŠæ‰‹ã€‚å¸¸è¦‹æ–¼åŒ—éƒ¨è²å¡šã€‚";
                } else if(name.includes("å‘å—")) {
                    info = "ğŸ’¡ é—œéµç‰¹å¾µï¼šæ©™ç´…å¤¾ç ‚é™¶ã€é›™æŠŠç½ã€‚æ±éƒ¨æ–°çŸ³å™¨æ™‚ä»£ä»£è¡¨ã€‚";
                } else {
                    info = `è¾¨è­˜ä¿¡å¿ƒåº¦ï¼š${(top.probability * 100).toFixed(1)}%`;
                }
                detailContainer.innerHTML = info;
            } else {
                labelContainer.innerHTML = "æƒæä¸­...";
                detailContainer.innerHTML = "è«‹ç§»å‹•é¡é ­æˆ–èª¿æ•´å…‰ç·šï¼Œå°æº–é™¶ç‰‡ç‰¹å¾µã€‚";
            }
        }
    </script>
</body>
</html>

